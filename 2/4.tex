% vim:ft=tex:ts=4:sw=0
% Author: Plump Albert (plumpalbert@gmail.com)
\section{Описание выполнения индивидуального задания}
\subsection{Описание автоматизируемого приложения}
Для выполнения индивидуального задания необходимо автоматизировать развертывание
web-приложения расписания Липецкого Государственного Технического Университета и
настройку удаленного сервера с использованием системы управления удаленными
конфигурациями Ansible. Автоматизируемое приложение написано на языке
программирования PHP с использованием современного фреймворка для создания
web-приложений Laravel.

PHP -- C-подобный скриптовый язык общего назначения, интенсивно применяемый для
разработки web-приложений [\ref{ref:php-home}]. В настоящее время поддерживается
подавляющим большинством хостинг-провайдеров и является одним из лидеров среди
языков, применяющихся для создания динамических web-сайтов.

Laravel -- бесплатный web-фреймворк с открытым кодом, предназначенный для
разработки с использованием архитектурной модели MVC (англ. Model View
Controller -- модель-представление-контроллер). Фреймворк предоставляет
структуру и стартовый шаблон для создания web-приложений, позволяя
сфокусироваться на создании бизнес-процессов, не вдаваясь в подробности
реализации [\ref{ref:laravel-home}].

\subsection{Система управления удаленными конфигурациями Ansible}
Ansible представляет собой набор утилит командной строки для автоматизации
IT процессов. С ее помощью можно настраивать системы, разворачивать приложения,
а также управлять и более сложными задачами, такими как непрерывная интеграция
(CI, англ. continuous integration) [\ref{ref:ansible-docs}].

Типичный сценарий, по которому работает Ansible:
\begin{itemize}
    \item выбирает системы из специализированного файла, называемого
        \textquote{файлом инвентаря}, для которых будет выполнять последующие
        команды;
    \item подключается к удаленному узлу, обычно через протокол Secure Shell
        (SSH);
    \item копирует один или несколько модулей на удаленный узел и начинает
        выполнять команды, указанные пользователем.
\end{itemize}

Список команд для выполнения на удаленной машине описывается в
специализированных файлах, называемых сценариями (англ. playbook). Сценарии
используют язык разметки YAML и представляют собой последовательность
поименованных задач.

Ansible поддерживает группировку задач в отдельные группы.
Это позволяет разделить большую конфигурацию на несколько отдельных, более
простых и узко-специализированных. Впоследствии в файле инвентаря отдельным
узлам можно назначить группу. На выбранных системах будут выполнены лишь
действия, которые нацелены на выбранную группу.

Ansible использует переменные, обеспечивая различные конфигурации для каждой
машины или группы машин. Переменные можно задавать в специализированных файлах,
напрямую в сценариях Ansible, файле инвентаря или при запуске команд в командной
строке.


\subsection{Программное обеспечение для контейнеризации приложений Docker}
Docker позволяет создавать изолированные окружения приложений -- контейнеры. Для
создания контейнера необходимо собрать его образ. Образы создаются из
специализированного файла, именуемого Dockerfile. Данный файл содержит
последовательность инструкций, которые сервер Docker выполняет во время создания
образа контейнера. Docker образы, благодаря использованию Aufs (англ. advanced
multi-layered unification filesystem), имеют \textquote{слоеную} структуру.
Каждая новая инструкция файла Dockerfile добавляет к базовому образу изменения в
конфигурации.

Для упрощения написания собственных образов в официальном репозитории -- Docker
Hub -- существует огромное количество уже готовых, которые можно
использовать как \textquote{стартовую точку}. Большинство популярных
фреймворков имеет свои образы Docker, что позволяет настроить уже готовое
решение для своих нужд, не имея опыта работы с Docker.

\subsection{Разработка конфигурации автоматического развертывания приложения}
Для автоматизации приложения расписания Липецкого Государственного Технического
Университета мною был создан Docker образ. В качестве начальной точки был
использован официальный образ PHP версии 8.0 с поддержкой PHP-FPM на базе ядра
ОС Alpine Linux. Поскольку приложение написано с использованием фреймворка
Laravel, а в качестве СУБД использована PostgreSQL, к существующему образу
необходимо добавить обязательные зависимости -- PDO, PDO\_PGSQL, bcmath. В
качестве менеджера пакетов использован Composer. Переменные окружения для
приложения расположены в текстовом файле с названием .env. При старте контейнера
следует запускать сервер PHP-FPM, который будет обрабатывать запросы клиентов и
выполнять PHP-скрипты. Для обеспечения удаленного доступа к этому серверу в
контейнере опубликован порт 9000. Листинг разработанного Dockerfile представлен
в приложении А.

В качестве обратного прокси-сервера используется Nginx. Конфигурация сайта
выполнена таким образом, что статичные файлы (изображения, шрифты, JavaScript и
CSS файлы и т.п.) обслуживаются Nginx напрямую, а скрипты на языке PHP
перенаправляются серверу PHP-FPM созданного выше Docker-контейнера. Листинг
конфигурации Nginx представлен в приложении Б.

Для автоматизации развертывания созданного выше web-приложения был написан
сценарий Ansible. Для удобства эта задача была поделена на несколько этапов:
\begin{enumerate}
    \item базовая настройка удаленного сервера;
    \item установка и настройка Docker на сервере;
    \item установка и настройка обратного прокси-сервера Nginx на сервере;
    \item развертывание приложения;
    \item настройка удаленного подключения к серверу.
\end{enumerate}

Листинги сценариев Ansible представлены в приложениях В -- Ж.
